[supervisord]
nodaemon=true

[program:jupyterlab]
command=/usr/local/bin/jupyter lab --ip=0.0.0.0 --port=8888 --allow-root --no-browser

[program:vncserver]
command=/bin/bash -c "sleep 2 && su - deScier -c 'mkdir -p ~/.vnc && vncserver :1 -geometry 1920x1080 && tail -F ~/.vnc/*.log'"
environment=HOME="/home/deScier",USER="deScier",DISPLAY=":1",XAUTHORITY="/home/deScier/.Xauthority"
directory=/home/deScier

[program:novnc]
command=/bin/bash -c "sleep 3 && websockify --web=/usr/share/novnc/ 6080 localhost:5901"

[program:ollama]
command=ollama serve
autorestart=true

[program:ipfs]
command=/bin/bash -c "sleep 5 && su - deScier -c 'ipfs daemon --enable-gc --routing=dht'"
user=deScier
environment=HOME="/home/deScier",USER="deScier"
directory=/home/deScier
autorestart=true
autostart=true

[program:academic-platform]
command=/bin/bash -c "sleep 10 && cd /home/deScier/DeSciOS/node && rm -f /home/deScier/.academic/database.sqlite && DATABASE_PATH=/home/deScier/.academic/database.sqlite npm start"
user=deScier
environment=HOME="/home/deScier",USER="deScier",NODE_ENV="production",PORT="8000",IPFS_API_URL="http://localhost:5001",DATABASE_PATH="/home/deScier/.academic/database.sqlite",UPLOADS_PATH="/home/deScier/.academic/uploads",JWT_SECRET="descios-academic-platform-secret"
directory=/home/deScier/DeSciOS/node
autorestart=true
autostart=true
stdout_logfile=/var/log/supervisor/academic-platform.log
stderr_logfile=/var/log/supervisor/academic-platform-error.log
